<!DOCTYPE html>


<html theme="dark" showBanner="true" hasBanner="false" > 
<link href="/fontawesome/css/fontawesome.css" rel="stylesheet">
<link href="/fontawesome/css/brands.css" rel="stylesheet">
<link href="/fontawesome/css/solid.css" rel="stylesheet">
<script src="/js/color.global.min.js" ></script>
<script src="/js/load-settings.js" ></script>
<head>
  <meta charset="utf-8">
  
  
  

  
  <title>Web安全学习笔记 | crumbling&#39;s secret room</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" href="/css/fonts/Roboto-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
  <link rel="preload" href="/css/fonts/Roboto-Bold.ttf" as="font" type="font/ttf" crossorigin="anonymous">
  <link rel="preload" href="/css/fonts/MaterialSymbolsRounded.woff2" as="font" type="font/woff2" crossorigin="anonymous">

  <meta name="description" content="学了好长一段时间开发，SpringBoot相关内容基本学完了（感觉只是正常学完的水平），想背八股找个实习做做看，但学长一说最近又有些动摇是不是可以转做web安全，毕竟开发感觉还是蛮无聊的。 总之沉淀一下吧，可能会两边都一起准备。 计算机网络与协议部分 OWASP SQL注入 XSS SSRF PHP Clickjacking CORS Other 参考 计算机网络与协议部分大概算是复习，不是重点，">
<meta property="og:type" content="article">
<meta property="og:title" content="Web安全学习笔记">
<meta property="og:url" content="http://example.com/2024/05/24/Web%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="crumbling&#39;s secret room">
<meta property="og:description" content="学了好长一段时间开发，SpringBoot相关内容基本学完了（感觉只是正常学完的水平），想背八股找个实习做做看，但学长一说最近又有些动摇是不是可以转做web安全，毕竟开发感觉还是蛮无聊的。 总之沉淀一下吧，可能会两边都一起准备。 计算机网络与协议部分 OWASP SQL注入 XSS SSRF PHP Clickjacking CORS Other 参考 计算机网络与协议部分大概算是复习，不是重点，">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2024/05/24/Web%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/ct_htmltree.gif">
<meta property="og:image" content="http://example.com/Web%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240529152554853.png">
<meta property="article:published_time" content="2024-05-24T06:54:40.652Z">
<meta property="article:modified_time" content="2024-05-29T08:06:10.067Z">
<meta property="article:author" content="crumbling">
<meta property="article:tag" content="Web">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2024/05/24/Web%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/ct_htmltree.gif">
  
    <link rel="alternate" href="/atom.xml" title="crumbling's secret room" type="application/atom+xml">
  
  
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-32.png" sizes="32x32">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-128.png" sizes="128x128">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-180.png" sizes="180x180">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-192.png" sizes="192x192">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-32.png" sizes="32x32">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-128.png" sizes="128x128">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-180.png" sizes="180x180">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-192.png" sizes="192x192">
  
  
<link rel="stylesheet" href="/css/style.css">

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head>

<body>
  
   
  <div id="main-grid" class="shadow   ">
    <div id="nav" class=""  >
      <navbar id="navbar">
  <nav id="title-nav">
    <a href="/">
      <div id="vivia-logo">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <div>crumbling's secret room </div>
    </a>
  </nav>
  <nav id="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    <a id="theme-btn" class="nav-icon">
      <span class="material-symbols-rounded light-mode-icon">wb_sunny</span>
      <span class="material-symbols-rounded dark-mode-icon">dark_mode</span>
    </a>
    
      <a id="nav-rss-link" class="nav-icon mobile-hide" href="/atom.xml" title="RSS 订阅">
        <span class="material-symbols-rounded rss">rss_feed</span>
      </a>
    
    <a id="nav-search-btn" class="nav-icon" title="搜索" style="display: none;">
      <span class="material-symbols-rounded">search</span>
    </a>
    <div id="nav-menu-btn" class="nav-icon">
      <span class="material-symbols-rounded">menu</span>
    </div>
  </nav>
</navbar>
<div id="nav-dropdown" class="hidden">
  <div id="dropdown-link-list">
    
      <a class="nav-dropdown-link" href="/">Home</a>
    
      <a class="nav-dropdown-link" href="/archives">Archives</a>
    
      <a class="nav-dropdown-link" href="/about">About</a>
    
    
      <a class="nav-dropdown-link" href="/atom.xml" title="RSS 订阅">RSS</a>
     
    </div>
</div>
<script>
  let dropdownBtn = document.getElementById("nav-menu-btn");
  let dropdownEle = document.getElementById("nav-dropdown");
  dropdownBtn.onclick = function() {
    dropdownEle.classList.toggle("hidden");
  }
</script>
    </div>
    <div id="sidebar-wrapper">
      <sidebar id="sidebar">
  
    <div class="widget-wrap">
  <div class="info-card">
    <div class="avatar">
      
      <div class="img-dim"></div>
    </div>
    <div class="info">
      <div class="username">crumbling </div>
      <div class="dot"></div>
      <div class="subtitle">This is the subtitle </div>
      <div class="link-list">
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://twitter.com" title="Twitter"><i class="fa-brands fa-twitter"></i></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://steamcommunity.com/profiles/76561199334949091/" title="Steam"><i class="fa-brands fa-steam"></i></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://github.com/fcrumbling" title="GitHub"><i class="fa-brands fa-github"></i></a>
         
      </div>  
    </div>
  </div>
</div>

  
  <div class="sticky">
    
      



    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">标签</h3>
      <ul class="widget-tag-list" itemprop="keywords"><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Crypto/" rel="tag">Crypto</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Web/" rel="tag">Web</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/gb%E5%9F%BA/" rel="tag">gb基</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/hnp/" rel="tag">hnp</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E6%A0%BC%E5%AF%86%E7%A0%81/" rel="tag">格密码</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E6%B7%B1%E5%BA%A6%E6%90%9C%E7%B4%A2/" rel="tag">深度搜索</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E7%9B%B8%E5%85%B3%E6%98%8E%E6%96%87%E6%94%BB%E5%87%BB/" rel="tag">相关明文攻击</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98/" rel="tag">背包问题</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E8%87%AA%E6%88%91%E4%BB%8B%E7%BB%8D/" rel="tag">自我介绍</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E9%9B%85%E5%85%8B%E6%AF%94%E7%AC%A6%E5%8F%B7/" rel="tag">雅克比符号</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E9%AB%98%E6%96%AF%E5%90%AF%E5%8F%91%E5%BC%8F/" rel="tag">高斯启发式</a></li></ul>
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">归档</h3>
      
      
        <a class="archive-link" href="/archives/2024/05 ">
          五月 2024 
          <div class="archive-count">2 </div>
        </a>
      
        <a class="archive-link" href="/archives/2023/12 ">
          十二月 2023 
          <div class="archive-count">1 </div>
        </a>
      
        <a class="archive-link" href="/archives/2023/11 ">
          十一月 2023 
          <div class="archive-count">1 </div>
        </a>
      
        <a class="archive-link" href="/archives/2023/10 ">
          十月 2023 
          <div class="archive-count">1 </div>
        </a>
      
        <a class="archive-link" href="/archives/2023/09 ">
          九月 2023 
          <div class="archive-count">5 </div>
        </a>
      
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">最新文章</h3>
      <ul>
        
          <a class="recent-link" href="/2024/05/27/Portswigger%E9%9D%B6%E5%9C%BA%E8%AE%B0%E5%BD%95/" title="PortSwigger靶场记录" >
            <div class="recent-link-text">
              PortSwigger靶场记录
            </div>
          </a>
        
          <a class="recent-link" href="/2024/05/24/Web%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="Web安全学习笔记" >
            <div class="recent-link-text">
              Web安全学习笔记
            </div>
          </a>
        
          <a class="recent-link" href="/2023/12/20/%E5%BC%BA%E7%BD%91%E6%9D%AF2023-crypto-%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/" title="强网杯2023-crypto-部分复现" >
            <div class="recent-link-text">
              强网杯2023-crypto-部分复现
            </div>
          </a>
        
          <a class="recent-link" href="/2023/11/02/2023ACTF-crypto%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/" title="2023ACTF——Crypto题目复现" >
            <div class="recent-link-text">
              2023ACTF——Crypto题目复现
            </div>
          </a>
        
          <a class="recent-link" href="/2023/10/29/DASCTF-CBCTF-crypto%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/" title="DASCTF-CBCTF-crypto部分赛题复现" >
            <div class="recent-link-text">
              DASCTF-CBCTF-crypto部分赛题复现
            </div>
          </a>
        
      </ul>
    </div>
  </div>

    
  </div>
</sidebar>
    </div>
    <div id="content-body">
       

<article id="post-Web安全学习笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
    
   
  <div class="article-inner">
    <div class="article-main">
      <header class="article-header">
        
<div class="main-title-bar">
  <div class="main-title-dot"></div>
  
    
      <h1 class="p-name article-title" itemprop="headline name">
        Web安全学习笔记
      </h1>
    
  
</div>

        <div class='meta-info-bar'>
          <div class="meta-info">
  <time class="dt-published" datetime="2024-05-24T06:54:40.652Z" itemprop="datePublished">2024-05-24</time>
</div>
          <div class="need-seperator meta-info">
            <div class="meta-cate-flex">
  
    未分类 
   
</div>
  
          </div>
          <div class="wordcount need-seperator meta-info">
            4.3k 词 
          </div>
        </div>
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web/" rel="tag">Web</a></li></ul>

      </header>
      <div class="e-content article-entry" itemprop="articleBody">
        
          <p>学了好长一段时间开发，SpringBoot相关内容基本学完了（感觉只是正常学完的水平），想背八股找个实习做做看，但学长一说最近又有些动摇是不是可以转做web安全，毕竟开发感觉还是蛮无聊的。</p>
<p>总之沉淀一下吧，可能会两边都一起准备。</p>
<p><a href="#1">计算机网络与协议部分</a></p>
<p><a href="#2">OWASP</a></p>
<p><a href="#sql">SQL注入</a></p>
<p><a href="#xss">XSS</a></p>
<p><a href="#ssrf">SSRF</a></p>
<p><a href="#php">PHP</a></p>
<p><a href="#clickjacking">Clickjacking</a></p>
<p><a href="#cors">CORS</a></p>
<p><a href="#Other">Other</a></p>
<p><a href="#">参考</a></p>
<h1 id="计算机网络与协议部分"><a href="#计算机网络与协议部分" class="headerlink" title="计算机网络与协议部分"></a><h1 id="1">计算机网络与协议部分</h1></h1><p>大概算是复习，不是重点，到Http协议，先看后面</p>
<h1 id="OWASP"><a href="#OWASP" class="headerlink" title="OWASP"></a><h1 id="2">OWASP</h1></h1><p>OWASP Top10 阅读<a target="_blank" rel="noopener" href="https://owasp.org/Top10/zh_CN/">首頁 - OWASP Top 10:2021</a></p>
<h1 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a><h1 id="sql">SQL注入</h1></h1><p>属于<strong>A03:2021-注入式攻击</strong></p>
<h2 id="SQL注入方法"><a href="#SQL注入方法" class="headerlink" title="SQL注入方法"></a>SQL注入方法</h2><h3 id="有回显的SQL注入"><a href="#有回显的SQL注入" class="headerlink" title="有回显的SQL注入"></a>有回显的SQL注入</h3><p>可以在应用程序的输出中看到数据库的查询结果</p>
<blockquote>
<p>通过sql注入，利用mysql自带得到库去获得敏感信息，然后获得更多的数据</p>
</blockquote>
<h3 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h3><p>无回显SQL注入</p>
<p>主要是通过<code>if(expression,if_true,if_false)</code>+正则匹配+枚举爆破的方式来找出数据</p>
<blockquote>
<p>if(DATABASE() rlike ‘^{exp}’,1,0) # 获取数据库名</p>
<p>if((SELECT GROUP_CONCAT(table_name, ‘:’, column_name) FROM information_schema.COLUMNS WHERE TABLE_SCHEMA = DATABASE()) rlike ‘^{exp}’,1,0) # 获取表名与字段名</p>
<p>if((SELECT binary GROUP_CONCAT(secret_string) FROM secret) rlike ‘^{exp}’,1,0) # 获取存储的数据</p>
</blockquote>
<p>当然，因为用AND连接if语句，所以很显然需要保证另一个式子要结果稳定，这也就能引出适用范围更广的时间盲注</p>
<h3 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h3><p>TODO 没有实践成功，windows下signal的方式不行</p>
<p>无回显SQL注入</p>
<p>通过延时函数sleep，控制查询时间到的长短（超时返回一个报错去catch）来判断if语句真假</p>
<h3 id="基于报错的-SQL-注入-TODO"><a href="#基于报错的-SQL-注入-TODO" class="headerlink" title="基于报错的 SQL 注入 TODO"></a>基于报错的 SQL 注入 TODO</h3><p>捕获报错信息进行sql注入，报错注入需要利用函数，以及其相应的攻击方法</p>
<h3 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h3><p>当注入点允许一次性执行多个 SQL 语句。而且不仅限于 SELECT ， INSERT、SHOW、SET、UPDATE 等也都可以。</p>
<h3 id="二次注入"><a href="#二次注入" class="headerlink" title="二次注入"></a>二次注入</h3><p>简单来说，第一层是安全的，但是第二层没有响应的检查过滤等，那么第一层如果放过的数据里有注入内容，在第二层的时候就可以重复上述或其他的注入方法进行注入</p>
<h2 id="SQL-注入常见的过滤绕过方式-TODO-收集"><a href="#SQL-注入常见的过滤绕过方式-TODO-收集" class="headerlink" title="SQL 注入常见的过滤绕过方式 TODO 收集"></a>SQL 注入常见的过滤绕过方式 TODO 收集</h2><p>很显然过滤是为了防止sql注入，那也就意味着只要通过合适的方法绕过过滤，就可以正常进行注入了。</p>
<h1 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a><h1 id="xss">XSS</h1></h1><p>跨站脚本（Cross-site scripting）</p>
<p>属于<strong>A03:2021-注入式攻击</strong></p>
<blockquote>
<p>通过利用网页开发时留下的漏洞，注入恶意指令代码到网页，使用户加载并执行攻击者恶意制造的网页程序。这些恶意网页程序通常是JavaScript，但实际上也可以包括Java、 VBScript、 LiveScript、ActiveX、 Flash 或者甚至是普通的HTML。</p>
</blockquote>
<h2 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h2><h3 id="反射型（非持久型）XSS"><a href="#反射型（非持久型）XSS" class="headerlink" title="反射型（非持久型）XSS"></a>反射型（非持久型）XSS</h3><blockquote>
<p>反射型 XSS 一般可以由攻击者构造带有恶意代码参数的 URL 来实现，在构造的URL 地址被打开后，其中包含的恶意代码参数被浏览器解析和执行。</p>
<p>这种攻击的特点是非持久化，必须用户点击包含恶意代码参数的链接时才会触发。</p>
</blockquote>
<p>原理：用户的输入或可控参数被未经处理就输出到页面，就容易产生该漏洞</p>
<p>常出现在搜索等功能，可以利用搜索框执行一些程序语言的命令</p>
<h3 id="存储型（持久型）XSS"><a href="#存储型（持久型）XSS" class="headerlink" title="存储型（持久型）XSS"></a>存储型（持久型）XSS</h3><blockquote>
<p>不需要特制的链接来执行。仅需要提交 XSS 漏洞利用代码（反射型XSS通常只在url中）到一个网站上其他用户可能访问的地方。</p>
<p>这些地区可能是<code>博客评论，用户评论，留言板，聊天室，HTML 电子邮件，wikis</code>。一旦用户访问受感染的页，执行是自动的。</p>
</blockquote>
<p>其原理和反射型类似，但是恶意代码会被保存到服务器中，比如说留言板被注入了恶意代码，每次跳转到留言板就会触发代码</p>
<p>最常发生在由社区内容驱动的网站或 Web 邮件网站</p>
<h3 id="DOM型XSS"><a href="#DOM型XSS" class="headerlink" title="DOM型XSS"></a>DOM型XSS</h3><h4 id="什么是DOM"><a href="#什么是DOM" class="headerlink" title="什么是DOM"></a>什么是DOM</h4><p>DOM指的是DOM文档，也就是一份xml文档，可以将前端html的代码化为一个树状结构，方便程序和脚本能够轻松的动态访问和更新这个树状结构的内容、结构以及样式，且不需要经过服务端。</p>
<p>如图是一个HTML DOM 树：</p>
<p><img src="/2024/05/24/Web%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/ct_htmltree.gif" alt="DOM HTML tree"></p>
<h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>DOM有一个source和sink，可以理解为DOM操作函数的入口点和出口点，基于DOM的XSS就是因为将入口点的输入传递给出口点的时候被出口点函数执行导致的XSS。</p>
<p>DOM型xss可以在前端通过js渲染来完成数据的交互，达到插入数据造成xss脚本攻击，且不经过服务器的目的，属于前端js的漏洞，可以达到绕过WAF、躲避服务端的检测效果，而反射型和存储型显然都是需要与服务器进行交互的。</p>
<h4 id="如何测试基于DOM的XSS？"><a href="#如何测试基于DOM的XSS？" class="headerlink" title="如何测试基于DOM的XSS？"></a>如何测试基于DOM的XSS？</h4><ul>
<li>测试HTML sink</li>
<li>测试JS执行 sink</li>
</ul>
<p><strong>测试HTML sink</strong></p>
<p>测试HTML sink需要在sink处填充随机字母数字，然后观察在HTML页面中的位置。然后观察其上下文，调整payload以观察是否能够将内容从当前标签中脱离出来。</p>
<p><strong>测试JS执行sink</strong></p>
<p>测试JS执行sink比测试HTML sink困难一点，因为可能sink的输入不会显示在页面中，这就需要在sink处下断点进行调试，跟踪变量值的变化，可能sink的输入会赋给其他变量，剩下的操作与上面相同，依然是不断调整输入以触发XSS。</p>
<p>典例如：</p>
<ul>
<li>HTML类的——搜索结果直接放入img元素中返回，就可以提前闭合img并执行恶意代码。</li>
</ul>
<h3 id="通用型XSS"><a href="#通用型XSS" class="headerlink" title="通用型XSS"></a>通用型XSS</h3><h3 id="突变型XSS"><a href="#突变型XSS" class="headerlink" title="突变型XSS"></a>突变型XSS</h3><h1 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a><h1 id="ssrf">SSRF</h1></h1><p>什么是SSRF</p>
<blockquote>
<p>SSRF(服务器端请求伪造)是种由攻击者构造形成由服务端发起请求的一个安全漏洞。一般情况下SSRF攻击的目标是从外网无法访问的内部系统</p>
</blockquote>
<h1 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a><h1 id="csrf">CSRF</h1></h1><p>跨站请求伪造，是OWASP（Open Web Application Security Project）2021年<strong>A01：失效的[访问控制]</strong>中常见的CWE之一</p>
<blockquote>
<p>CSRF攻击是一种网络攻击方式，攻击者通过伪造用户身份，在用户毫不知情的情况下，以用户的名义发送恶意请求给受攻击站点。这些请求在权限保护之下执行，对用户和网站造成严重的危害。</p>
</blockquote>
<p>简单来说是攻击者在一个网站上伪造请求，以便在另一个网站上执行操作。</p>
<blockquote>
<p>例如，Jane 可能会在查看电子邮件的同时登录了她的网上银行，然后可能会点进钓鱼邮件中的自带转账请求的链接（比如迷惑性的短链接），要求 Jane 的银行转账至被攻击者控制的账户里。</p>
<p>由于 Jane 已经登陆了银行，该转账请求会被自动执行，因为是通过已被 Jane 授权了的浏览器发出的请求。</p>
</blockquote>
<h3 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h3><p>CSRF攻击利用了Web的身份验证机制的缺陷。虽然Web的身份验证机制可以保证一个请求是来自某个用户的浏览器，但却无法保证该请求是用户批准发送的。攻击者通过在第三方网站上放置恶意代码，诱导用户访问被攻击的网站并完成恶意请求。整个过程用户并不知情，因此很难防范。</p>
<h3 id="类型-1"><a href="#类型-1" class="headerlink" title="类型"></a>类型</h3><h3 id="GET"><a href="#GET" class="headerlink" title="GET"></a>GET</h3><p>CSRF的本质原因是重要操作的所有参数都是可以被攻击者猜测到的。</p>
<p>比如说攻击者猜到银行转账使用以下GET请求完成转账</p>
<p><code>http://www.bank.com/Transfer.php?toName=username&amp;money=1</code></p>
<p>而在危险站点中有这样一段html</p>
<p><code>&lt;img src=http://www.bank.com/Transfer.php?toName=Hacker&amp;money=100000&gt;</code></p>
<p>一般来说都是受害者登录受信任站点A，并在本地生成Cookie（放在浏览器中）。在不登出A的情况下，访问危急站点B。</p>
<p>那么，账户里就会少100000块钱。</p>
<p>常使用HTML中<image>、<iframe>、<script>等带“src”属性的标签</p>
<h3 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h3><p>如果不对请求方法进行限制，那么依然可以通过构造GET请求完成CSRF,但如果已经区分，那么最简单的方法就是提前构造好一个表单，利用js自动提交表单</p>
<p>攻击者的这个页面可以隐藏在一个不可见的iframe窗口中，让用户发现不了</p>
<h3 id="防御"><a href="#防御" class="headerlink" title="防御"></a>防御</h3><h4 id="1-检测"><a href="#1-检测" class="headerlink" title="1.检测"></a>1.检测</h4><p>验证请求的来源地址。可以通过检查请求头部中的Referer字段来判断请求的来源，如果请求的来源地址与目标地址不一致，则可能存在CSRF攻击。</p>
<p>如果Referer字段为空或者与目标地址不一致，也可能会是CSRF攻击。</p>
<h4 id="2-防范手段"><a href="#2-防范手段" class="headerlink" title="2.防范手段"></a>2.防范手段</h4><ul>
<li><strong>添加token验证。</strong>在用户登录后生成token并存储在session中（印象里现在是不是jwt更多一些？），然后在处理敏感操作的时候对token进行验证【这里衍生出很多相关的攻击，可见靶场的题目记录】</li>
<li><strong>二次验证。</strong>在关键操作之前，要求用户提供当前密码或验证码进行验证。这种方法虽然会对用户体验产生影响，但对于高敏感度的操作来说，却是非常有效的防护手段。</li>
<li><strong>配置HTTP头部信息。</strong>例如，设置合适的Content-Security-Policy头部可以限制浏览器加载资源的来源，从而降低CSRF攻击的风险。</li>
</ul>
<h1 id="Clickjacking"><a href="#Clickjacking" class="headerlink" title="Clickjacking"></a><h1 id ="clickjacking">Clickjacking</h1></h1><p>点击劫持</p>
<p>属于<strong>A06:2021 - Vulnerable and Outdated Components</strong>（<strong>危险或过旧的组件</strong>）下的一种威胁，与UI相关的安全问题密切相关</p>
<h2 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h2><p>攻击者通过使用一个透明的iframe，覆盖在一个网页上，然后诱使用户在该页面上进行操作，通过调整iframe页面的位置，可以使得伪造的页面恰好和iframe里受害页面里一些功能重合（比如说按钮、超链接）。</p>
<p>Clickjacking是仅此于XSS和CSRF的前端漏洞。</p>
<h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><h3 id="1、目标网页隐藏技术"><a href="#1、目标网页隐藏技术" class="headerlink" title="1、目标网页隐藏技术"></a>1、目标网页隐藏技术</h3><p>攻击者在恶意网站上通过 iframe 载入目标网页，隐藏目标网页，欺骗用户点击隐藏的恶意链接。目前主要的网页隐藏技术有两种：CSS隐藏技术和双iframe隐藏技术。<br><strong>CSS 隐藏技术</strong>的原理是利用 CSS 技术控制网页内容显示的效果。其中opacity参数表示元素的透明度，取值范围为0~1，默认值为1表示不透明， 取值为0时元素在网页中完全透明显示。当设置目标 iframe 的opacity 属性小于或等于0.1，用户就无法看到含恶意代码的目标网页。<br><strong>双iframe隐藏</strong>技术使用内联框架和外联框架。内联框架的主要功能是载入目标网页，并将目标网页定位到特定按钮或者链接。外联框架的主要功能是筛选，只显示内联框架中特定的按钮。</p>
<h3 id="2、点击操作劫持"><a href="#2、点击操作劫持" class="headerlink" title="2、点击操作劫持"></a>2、点击操作劫持</h3><p>在成功隐藏目标网页后，攻击者下一个目标是欺骗用户点击特定的按钮，最简单实用的方法是使用社会工程学。例如，将攻击按钮外观设计成类似QQ消息的提示按钮，诱使用户点击从而触发攻击行为。另外一种思路是使用脚本代码以及其他技术增加用户点击特定按钮的概率。主要方法如JavaScript实现鼠标跟随技术、按键劫持 (Stroke jacking) 技术等。</p>
<h3 id="3、拖拽（Drag-and-Drop）技术"><a href="#3、拖拽（Drag-and-Drop）技术" class="headerlink" title="3、拖拽（Drag and Drop）技术"></a>3、拖拽（Drag and Drop）技术</h3><p>主流的浏览器都有drag-and-drop API 接口，供网站开发人员创建交互式网页。但是，这些 API 接口在设计时没有考虑很多的安全性问题，导致通过拖拽就可以实现跨域操作。利用拖拽技术，攻击者可以突破很多已有的安全防御措施，<br>利用拖拽技术，攻击者可以轻易将文本注入到目标网页。在实际实施过程中，攻击者欺骗用户选择输入框的内容，完成拖拽操作。另外一种方式是，通过浏览器的 API 接口将 iframe 中的内容拖拽到目标网页的 text area 中，攻击者就可以获得用户网页中存在的敏感信息。</p>
<h3 id="4、结合CSRF漏洞"><a href="#4、结合CSRF漏洞" class="headerlink" title="4、结合CSRF漏洞"></a>4、结合CSRF漏洞</h3><p>跨站点请求伪造漏洞需要获得正确token值，而Clickjacking可以做到被攻击者在未知的情况下泄露自己的token</p>
<h3 id="5、结合XSS漏洞"><a href="#5、结合XSS漏洞" class="headerlink" title="5、结合XSS漏洞"></a>5、结合XSS漏洞</h3><p>反射型跨站点脚本漏洞是非持久型的漏洞，但通过Clickjacking，就变成了存储型XSS</p>
<h2 id="防御-1"><a href="#防御-1" class="headerlink" title="防御"></a>防御</h2><h3 id="1、FrameBusting代码"><a href="#1、FrameBusting代码" class="headerlink" title="1、FrameBusting代码"></a>1、FrameBusting代码</h3><p>点击劫持攻击需要首先将目标网站载入到恶意网站中，使用 iframe 载入网页是最有效的方法。使用 JavaScript编写的Frame Busting 脚本阻止恶意网站载入网页——如果检测到网页被非法网页载入，就执行自动跳转功能。</p>
<p>如果用户浏览器禁用JavaScript脚本，那么FrameBusting代码也无法正常运行。</p>
<h3 id="2、-X-FRAME-OPTIONS-机制"><a href="#2、-X-FRAME-OPTIONS-机制" class="headerlink" title="2、 X-FRAME-OPTIONS 机制"></a>2、 X-FRAME-OPTIONS 机制</h3><p>部分浏览器支持</p>
<p>该机制有两个选项：DENY 和 SAMEORIGIN。DENY表示任何网页都不能使用 iframe 载入该网页，SAMEORIGIN表示符合同源策略的网页可以使用 iframe载入该网页。</p>
<h3 id="3、Content-Security-Policy"><a href="#3、Content-Security-Policy" class="headerlink" title="3、Content Security Policy"></a>3、Content Security Policy</h3><p>“网页安全政策”（Content Security Policy，缩写 CSP），一种白名单制度。</p>
<h3 id="4、-NoScript-扩展"><a href="#4、-NoScript-扩展" class="headerlink" title="4、 NoScript 扩展"></a>4、 NoScript 扩展</h3><p>Firefox的NoScript扩展</p>
<h1 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a><h1 id="cors">CORS</h1></h1><p>Cross-origin resource sharing</p>
<p><strong>A01:2021 - Broken Access Control</strong>（访问控制缺陷）</p>
<ul>
<li>如果 CORS 配置不正确，可能允许来自恶意来源的请求访问受限资源，导致未授权的数据泄露或修改。</li>
</ul>
<p><strong>A05:2021 - Security Misconfiguration</strong>（安全配置错误）</p>
<ul>
<li>CORS 配置错误（如不安全的 <code>Access-Control-Allow-Origin</code> 设置）属于安全配置错误的一部分。</li>
</ul>
<h2 id="啥是CORS"><a href="#啥是CORS" class="headerlink" title="啥是CORS"></a>啥是CORS</h2><p>个人理解，出于安全浏览器根据同源安全策略（SOP）限制跨域HTTP请求，但也带来了不便，在此情况下CORS可以绕过SOP使得跨源/跨域访问可以成功</p>
<p><strong>关于同源安全策略</strong></p>
<blockquote>
<p><img src="/Web安全学习笔记/image-20240529152554853.png" alt="image-20240529152554853"></p>
</blockquote>
<p><strong>两种请求</strong></p>
<p>浏览器将CORS请求分为简单请求和非简单请求。</p>
<p>简单请求为：</p>
<ul>
<li>请求方式为GET，POST，HEAD这三种之一</li>
<li>HTTP头不超出（Accept，Accept-Language，Content-Language，Lat-Event-ID，Content-Type）这几种字段</li>
</ul>
<p>对于简单请求，浏览器会自动在Header里添加Origin,用来说明本次请求来自哪个源（协议 + 域名 + 端口），如果不被许可，那么会收到不包含<code>Access-Control-Allow-Origin</code>的响应（但状态码可能还是200）。</p>
<p>反之会包含</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ccess-Control-Allow-Origin<span class="punctuation">:</span> </span><br><span class="line">Access-Control-Allow-Credentials<span class="punctuation">:</span> </span><br><span class="line">Access-Control-Expose-Headers<span class="punctuation">:</span></span><br></pre></td></tr></table></figure>
<p>其中ccess-Control-Allow-Origin:为必须，表示允许哪个域访问，如果为*则表示全部，这样就引出来了CORS相关的漏洞</p>
<h2 id="漏洞"><a href="#漏洞" class="headerlink" title="漏洞"></a>漏洞</h2><h1 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a><h1 id="php">PHP</h1></h1><h2 id="文件包含漏洞"><a href="#文件包含漏洞" class="headerlink" title="文件包含漏洞"></a>文件包含漏洞</h2><h3 id="伪协议读取文件"><a href="#伪协议读取文件" class="headerlink" title="伪协议读取文件"></a>伪协议读取文件</h3><p>常见伪协议： <code>php://filter</code>、<code>php://input</code>、<code>php://memory</code></p>
<p>常见格式：<strong>filename=php://filter/read=convert.base64-encode/resource=</strong>（不知道是我见识少了还是刻板印象，这里的read似乎本来就不需要，后面写的绕过其实也是没有用到read的）</p>
<p>相关绕过：convert.base64-encode 是对于编码格式的操作，将读取到的内容以Base64的格式加密，可以替换为<code>convert.quoted-printable-encode、convert.iconv.&lt;input-encoding&gt;.&lt;output-encoding&gt;</code></p>
<p>如：<strong>filename=php://filter/convert.iconv.utf8.utf16/resource=</strong></p>
<h2 id="弱类型比较"><a href="#弱类型比较" class="headerlink" title="弱类型比较"></a>弱类型比较</h2><p>比较大小：’123a‘作为数字进行比较会转换成123，’a123‘，’aaaaa‘则为0</p>
<h2 id="反序列化绕过wakeup"><a href="#反序列化绕过wakeup" class="headerlink" title="反序列化绕过wakeup"></a>反序列化绕过wakeup</h2><blockquote>
<p>PHP反序列化漏洞：执行unserialize()时，先会调用__wakeup()。</p>
<p>当序列化字符串中属性值个数大于属性个数，就会导致反序列化异常，从而跳过__wakeup()。</p>
</blockquote>
<h1 id="Other"><a href="#Other" class="headerlink" title="Other"></a><h1 id='other'>Other</h1></h1><h2 id="robots-txt"><a href="#robots-txt" class="headerlink" title="robots.txt"></a>robots.txt</h2><blockquote>
<p>robots.txt是一种文本文件，<strong>用于告知搜索引擎爬虫哪些页面可以被抓取、哪些页面不应被抓取</strong>。通常，网站管理员会在网站的根目录下放置一个名为robots.txt的文件，并使用该文件指定他们希望搜索引擎索引和不索引的页面。</p>
</blockquote>
<p>通过此文件，有时候可以观察到目录结构，进而发现flag的位置</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>可能会漏掉一些参考((</p>
<p><a target="_blank" rel="noopener" href="https://www.freecodecamp.org/chinese/news/what-is-cross-site-request-forgery/#:~:text=跨站点请求伪造（Cross Site Request,Forgery）又被称作 CSRF，是恶意站点或程序通过已认证用户的浏览器在受信任站点上执行非正常操作。 可进行的恶意操作局限于已在网站通过身份验证的用户的功能。">跨站请求伪造——什么是 CSRF 攻击以及如何预防它 (freecodecamp.org)</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43378996/article/details/123910614">CSRF漏洞原理攻击与防御（非常细）-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.baidu.com/article/details/3149888">CSRF攻击与防御：深入浅出的解析与实践-百度开发者中心 (baidu.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1516375">点击劫持（ClickJacking）漏洞挖掘及实战案例全汇总-腾讯云开发者社区-腾讯云 (tencent.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy">浏览器的同源策略 - Web 安全 | MDN (mozilla.org)</a></p>
</script></iframe></image></p>
        
      </div>

         
    </div>
    
     
  </div>
  
    
<nav id="article-nav">
  <a class="article-nav-btn left "
    
      href="/2024/05/27/Portswigger%E9%9D%B6%E5%9C%BA%E8%AE%B0%E5%BD%95/"
      title="PortSwigger靶场记录"
     >
    <i class="fa-solid fa-angle-left"></i>
    <p class="title-text">
      
        PortSwigger靶场记录
        
    </p>
  </a>
  <a class="article-nav-btn right "
    
      href="/2023/12/20/%E5%BC%BA%E7%BD%91%E6%9D%AF2023-crypto-%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/"
      title="强网杯2023-crypto-部分复现"
     >

    <p class="title-text">
      
        强网杯2023-crypto-部分复现
        
    </p>
    <i class="fa-solid fa-angle-right"></i>
  </a>
</nav>


  
</article>

 
    </div>
    <div id="footer-wrapper">
      <footer id="footer">
  
  <div id="footer-info" class="inner">
    
    &copy; 2024 crumbling<br>
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & Theme <a target="_blank" rel="noopener" href="https://github.com/saicaca/hexo-theme-vivia">Vivia</a>
  </div>
</footer>

    </div>
    <div class="back-to-top-wrapper">
    <button id="back-to-top-btn" class="back-to-top-btn hide" onclick="topFunction()">
        <span class="material-symbols-rounded">keyboard_arrow_up</span>
    </button>
</div>

<script>
    function topFunction() {
        window.scroll({ top: 0, behavior: 'smooth' });
    }
    let btn = document.getElementById('back-to-top-btn');
    function scrollFunction() {
        if (document.body.scrollTop > 600 || document.documentElement.scrollTop > 600) {
            btn.classList.remove('hide')
        } else {
            btn.classList.add('hide')
        }
    }
    window.onscroll = function() {
        scrollFunction();
    }
</script>

  </div>
  <script src="/js/light-dark-switch.js"></script>
</body>
</html>
