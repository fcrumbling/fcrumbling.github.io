<!DOCTYPE html>


<html theme="dark" showBanner="true" hasBanner="false" > 
<link href="/fontawesome/css/fontawesome.css" rel="stylesheet">
<link href="/fontawesome/css/brands.css" rel="stylesheet">
<link href="/fontawesome/css/solid.css" rel="stylesheet">
<script src="/js/color.global.min.js" ></script>
<script src="/js/load-settings.js" ></script>
<head>
  <meta charset="utf-8">
  
  
  

  
  <title>2023DSACTF——Crypto题目复现 | crumbling&#39;s secret room</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" href="/css/fonts/Roboto-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
  <link rel="preload" href="/css/fonts/Roboto-Bold.ttf" as="font" type="font/ttf" crossorigin="anonymous">
  <link rel="preload" href="/css/fonts/MaterialSymbolsRounded.woff2" as="font" type="font/woff2" crossorigin="anonymous">

  <meta name="description" content="目录  7月赛 ezAlgebra  7月赛 ezRSA   7月赛 ezAlgebra2023DASCTF&amp;0X401 WriteUp (qq.com)涉及到groebner_basis 一个没怎么见过的东西，打算来复现一下  (18条消息) Gröbner基的简单介绍与一些参考文献_grobner基_RayLee23333的博客-CSDN博客里面还有提到一篇论文——Gr¨obner B">
<meta property="og:type" content="article">
<meta property="og:title" content="2023DSACTF——Crypto题目复现">
<meta property="og:url" content="http://example.com/2023/09/06/2023DSACTF-Crypto%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/index.html">
<meta property="og:site_name" content="crumbling&#39;s secret room">
<meta property="og:description" content="目录  7月赛 ezAlgebra  7月赛 ezRSA   7月赛 ezAlgebra2023DASCTF&amp;0X401 WriteUp (qq.com)涉及到groebner_basis 一个没怎么见过的东西，打算来复现一下  (18条消息) Gröbner基的简单介绍与一些参考文献_grobner基_RayLee23333的博客-CSDN博客里面还有提到一篇论文——Gr¨obner B">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2023/09/06/2023DSACTF-Crypto%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/pic.png">
<meta property="article:published_time" content="2023-09-06T10:15:27.396Z">
<meta property="article:modified_time" content="2023-11-02T09:19:54.200Z">
<meta property="article:author" content="crumbling">
<meta property="article:tag" content="-Crypto">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2023/09/06/2023DSACTF-Crypto%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/pic.png">
  
    <link rel="alternate" href="/atom.xml" title="crumbling's secret room" type="application/atom+xml">
  
  
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-32.png" sizes="32x32">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-128.png" sizes="128x128">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-180.png" sizes="180x180">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-192.png" sizes="192x192">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-32.png" sizes="32x32">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-128.png" sizes="128x128">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-180.png" sizes="180x180">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-192.png" sizes="192x192">
  
  
<link rel="stylesheet" href="/css/style.css">

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>

<body>
  
   
  <div id="main-grid" class="shadow   ">
    <div id="nav" class=""  >
      <navbar id="navbar">
  <nav id="title-nav">
    <a href="/">
      <div id="vivia-logo">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <div>crumbling's secret room </div>
    </a>
  </nav>
  <nav id="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    <a id="theme-btn" class="nav-icon">
      <span class="material-symbols-rounded light-mode-icon">wb_sunny</span>
      <span class="material-symbols-rounded dark-mode-icon">dark_mode</span>
    </a>
    
      <a id="nav-rss-link" class="nav-icon mobile-hide" href="/atom.xml" title="RSS 订阅">
        <span class="material-symbols-rounded rss">rss_feed</span>
      </a>
    
    <a id="nav-search-btn" class="nav-icon" title="搜索" style="display: none;">
      <span class="material-symbols-rounded">search</span>
    </a>
    <div id="nav-menu-btn" class="nav-icon">
      <span class="material-symbols-rounded">menu</span>
    </div>
  </nav>
</navbar>
<div id="nav-dropdown" class="hidden">
  <div id="dropdown-link-list">
    
      <a class="nav-dropdown-link" href="/">Home</a>
    
      <a class="nav-dropdown-link" href="/archives">Archives</a>
    
      <a class="nav-dropdown-link" href="/about">About</a>
    
    
      <a class="nav-dropdown-link" href="/atom.xml" title="RSS 订阅">RSS</a>
     
    </div>
</div>
<script>
  let dropdownBtn = document.getElementById("nav-menu-btn");
  let dropdownEle = document.getElementById("nav-dropdown");
  dropdownBtn.onclick = function() {
    dropdownEle.classList.toggle("hidden");
  }
</script>
    </div>
    <div id="sidebar-wrapper">
      <sidebar id="sidebar">
  
    <div class="widget-wrap">
  <div class="info-card">
    <div class="avatar">
      
      <div class="img-dim"></div>
    </div>
    <div class="info">
      <div class="username">crumbling </div>
      <div class="dot"></div>
      <div class="subtitle">This is the subtitle </div>
      <div class="link-list">
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://twitter.com" title="Twitter"><i class="fa-brands fa-twitter"></i></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://steamcommunity.com/profiles/76561199334949091/" title="Steam"><i class="fa-brands fa-steam"></i></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://github.com/fcrumbling" title="GitHub"><i class="fa-brands fa-github"></i></a>
         
      </div>  
    </div>
  </div>
</div>

  
  <div class="sticky">
    
      



    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">标签</h3>
      <ul class="widget-tag-list" itemprop="keywords"><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Crypto/" rel="tag">-Crypto</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E8%87%AA%E6%88%91%E4%BB%8B%E7%BB%8D/" rel="tag">-自我介绍</a></li></ul>
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">归档</h3>
      
      
        <a class="archive-link" href="/archives/2023/11 ">
          十一月 2023 
          <div class="archive-count">1 </div>
        </a>
      
        <a class="archive-link" href="/archives/2023/10 ">
          十月 2023 
          <div class="archive-count">1 </div>
        </a>
      
        <a class="archive-link" href="/archives/2023/09 ">
          九月 2023 
          <div class="archive-count">5 </div>
        </a>
      
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">最新文章</h3>
      <ul>
        
          <a class="recent-link" href="/2023/11/02/2023ACTF-crypto%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/" title="2023ACTF——Crypto题目复现" >
            <div class="recent-link-text">
              2023ACTF——Crypto题目复现
            </div>
          </a>
        
          <a class="recent-link" href="/2023/10/29/DASCTF-CBCTF-crypto%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/" title="DASCTF-CBCTF-crypto部分赛题复现" >
            <div class="recent-link-text">
              DASCTF-CBCTF-crypto部分赛题复现
            </div>
          </a>
        
          <a class="recent-link" href="/2023/09/20/2023WMCTF%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/" title="2023WMCTF——Crypto部分题目复现" >
            <div class="recent-link-text">
              2023WMCTF——Crypto部分题目复现
            </div>
          </a>
        
          <a class="recent-link" href="/2023/09/19/LFSR/" title="LFSR学习" >
            <div class="recent-link-text">
              LFSR学习
            </div>
          </a>
        
          <a class="recent-link" href="/2023/09/06/Hello/" title="Hello!" >
            <div class="recent-link-text">
              Hello!
            </div>
          </a>
        
      </ul>
    </div>
  </div>

    
  </div>
</sidebar>
    </div>
    <div id="content-body">
       

<article id="post-2023DSACTF-Crypto题目复现" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
    
   
  <div class="article-inner">
    <div class="article-main">
      <header class="article-header">
        
<div class="main-title-bar">
  <div class="main-title-dot"></div>
  
    
      <h1 class="p-name article-title" itemprop="headline name">
        2023DSACTF——Crypto题目复现
      </h1>
    
  
</div>

        <div class='meta-info-bar'>
          <div class="meta-info">
  <time class="dt-published" datetime="2023-09-06T10:15:27.396Z" itemprop="datePublished">2023-09-06</time>
</div>
          <div class="need-seperator meta-info">
            <div class="meta-cate-flex">
  
    未分类 
   
</div>
  
          </div>
          <div class="wordcount need-seperator meta-info">
            2.1k 词 
          </div>
        </div>
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Crypto/" rel="tag">-Crypto</a></li></ul>

      </header>
      <div class="e-content article-entry" itemprop="articleBody">
        
          <p><a href="#1">目录</a></p>
<ul>
<li><p><a href="#1">7月赛 ezAlgebra</a></p>
</li>
<li><p><a href="#2">7月赛 ezRSA</a></p>
</li>
</ul>
<h2 id="7月赛-ezAlgebra"><a href="#7月赛-ezAlgebra" class="headerlink" title="7月赛 ezAlgebra"></a><h2 id="1">7月赛 ezAlgebra</h2></h2><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=Mzg3MjcwOTAwNw==&amp;mid=2247484933&amp;idx=1&amp;sn=60ae6e59096e22a2b60bb7ba4e80ce04&amp;chksm=ceea68e5f99de1f3b072baf3c069c4f1530f5c17b34811e51133d42fbfe9de4638d5b5f14071&amp;mpshare=1&amp;scene=23&amp;srcid=072376b235QJm9tNCYWMZFQU&amp;sharer_sharetime=1690091289890&amp;sharer_shareid=9c0f9b7dd366a1431577547d077f70be#rd">2023DASCTF&amp;0X401 WriteUp (qq.com)</a>涉及到groebner_basis 一个没怎么见过的东西，打算来复现一下</p>
<p> <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_33458986/article/details/103198580">(18条消息) Gröbner基的简单介绍与一些参考文献_grobner基_RayLee23333的博客-CSDN博客</a>里面还有提到一篇论文——<strong>Gr¨obner Bases: a Tutorial</strong>。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_52640415/article/details/131871276">[DASCTF 2023 &amp; 0X401七月暑期挑战赛] crypto_石氏是时试的博客-CSDN博客</a>还参考了这个</p>
<p>源码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, bytes_to_long</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">YiJiuJiuQiNian</span>(<span class="params">Wo, Xue, Hui, Le, Kai</span>):</span><br><span class="line">    Qi = <span class="number">1997</span></span><br><span class="line">    Che = Wo+Hui <span class="keyword">if</span> Le==<span class="number">1</span> <span class="keyword">else</span> Wo*Hui</span><br><span class="line">    <span class="keyword">while</span>(Xue):</span><br><span class="line">        Qi += (<span class="built_in">pow</span>(Che, Xue, Kai)) % Kai</span><br><span class="line">        Xue -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> Qi</span><br><span class="line">    </span><br><span class="line">l = <span class="number">512</span></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">p = getPrime(l)</span><br><span class="line">q = getPrime(l//<span class="number">2</span>)</span><br><span class="line">r = getPrime(l//<span class="number">2</span>)</span><br><span class="line">n = p * q * r</span><br><span class="line">t = getrandbits(<span class="number">32</span>)</span><br><span class="line">c1 = YiJiuJiuQiNian(t, <span class="number">4</span>, p, <span class="number">1</span>, n)</span><br><span class="line">c2 = YiJiuJiuQiNian(m, <span class="number">19</span>, t, <span class="number">0</span>, q)</span><br><span class="line">c3 = YiJiuJiuQiNian(m, <span class="number">19</span>, t, <span class="number">1</span>, q)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"n = <span class="subst">{n}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"c1 = <span class="subst">{c1}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"c2 = <span class="subst">{c2}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"c3 = <span class="subst">{c3}</span>"</span>)</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">n = 119156144845956004769507478085325079414190248780654060840257869477965140304727088685316579445017214576182010373548273474121727778923582544853293534996805340795355149795694121455249972628980952137874014208209750135683003125079012121116063371902985706907482988687895813788980275896804461285403779036508897592103</span></span><br><span class="line"><span class="string">c1 = 185012145382155564763088060801282407144264652101028110644849089283749320447842262397065972319766119386744305208284231153853897076876529326779092899879401876069911627013491974285327376378421323298147156687497709488102574369005495618201253946225697404932436143348932178069698091761601958275626264379615139864425</span></span><br><span class="line"><span class="string">c2 = 722022978284031841958768129010024257235769706227005483829360633993196299360813</span></span><br><span class="line"><span class="string">c3 = 999691052172645326792013409327337026208773437618455136594949462410165608463231</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>
<p>第一部分：</p>
<p><em>c1 = 1997 + (p+t)^4 + (p+t)^3 +(p+t)^2+(p+t) mod n</em><br><em>c1 = 1997 + (p+t)^4 + (p+t)^3 +(p+t)^2+(p+t) mod p</em><br><em>c1 = 1997 + t^4 + t^3 + t^2 + t mod p</em> 该式显然对模n成立<br><em>c1 = 1997 + t^4 + t^3 + t^2 + t mod n</em></p>
<p>故在模n下求一元coppersmith可以解得t</p>
<p>将t代入f，由上方第三式可知，此时f=k*p，所以可以获得p</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">119156144845956004769507478085325079414190248780654060840257869477965140304727088685316579445017214576182010373548273474121727778923582544853293534996805340795355149795694121455249972628980952137874014208209750135683003125079012121116063371902985706907482988687895813788980275896804461285403779036508897592103</span></span><br><span class="line">c1 = <span class="number">185012145382155564763088060801282407144264652101028110644849089283749320447842262397065972319766119386744305208284231153853897076876529326779092899879401876069911627013491974285327376378421323298147156687497709488102574369005495618201253946225697404932436143348932178069698091761601958275626264379615139864425</span></span><br><span class="line">PR.&lt;x&gt;=PolynomialRing(Zmod(n))</span><br><span class="line">f=x^<span class="number">4</span>+x^<span class="number">3</span>+x^<span class="number">2</span>+x+<span class="number">1997</span>-c1</span><br><span class="line">t=f.small_roots(X=<span class="number">2</span>^<span class="number">32</span>,beta=<span class="number">0.4</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="comment">#t=2915836867</span></span><br><span class="line">f= t^<span class="number">4</span>+t^<span class="number">3</span>+t^<span class="number">2</span>+t-c1+<span class="number">1997</span></span><br><span class="line">p=gcd(f,n)</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line"><span class="comment">#p=12674045065380963936369006640913707206092165254372327547575287589116533343005456615635388048683828685030860153531390706945709086518510926980644275915726413</span></span><br></pre></td></tr></table></figure>
<p>第二部分：</p>
<p>论文对于求解环上方程组，先举了多元变量高斯消去法的例子和单变量欧几里得算法的例子，然后这个什么<strong>Gr¨obner bases</strong>是基于这俩者的关键特征提取出来的计算全局基算法。</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/278946425">Gröbner basis与多元多项式方程组 - 知乎 (zhihu.com)</a></p>
<p>多元环上取余运算的化简会用到Gr¨obner bases</p>
<p>简单看了一圈，大概意思就是对于一个多元多项式方程组，可以通过求Gr¨obner bases的方式，找到一个类似于线性代数中基础解系（和高斯消去法也是类似的原理，高斯消去法应该就是线性代数中将（A|b）化为行阶梯，只是该方法应用范围更广）的东西，然后求出来的这个基各个值为0，以此求得变量的值。</p>
<p><em>che=mt</em></p>
<p><em>c2-1997=che^19+che^18 +….+che mod q</em></p>
<p><em>c2-1997=che^19+che^18 +….+che mod (n//p)</em></p>
<p><em>che=(m+t)</em><br><em>c3-1997=che^19+che^18+….+che mod q</em> </p>
<p><em>c3-1997=che^19+che^18+….+che mod (n//p)</em> </p>
<p>t=2915836867</p>
<p>所以这里就是求解一个模n//p下3个方程的二元多项式方程组(有wp说直接模n不行，但是还是出来了)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">c2 = <span class="number">722022978284031841958768129010024257235769706227005483829360633993196299360813</span></span><br><span class="line">c3 = <span class="number">999691052172645326792013409327337026208773437618455136594949462410165608463231</span></span><br><span class="line">P.&lt;m,m0&gt; = PolynomialRing(Zmod(n))<span class="comment">#m0没用，只是1个变量后面会报错</span></span><br><span class="line">f1=t-<span class="number">2915836867</span></span><br><span class="line">f2=<span class="number">1997</span>-c2</span><br><span class="line">f3=<span class="number">1997</span>-c3</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line">    f2+=(m*t)^i</span><br><span class="line">    f3+=(m+t)^i</span><br><span class="line">F=[f1,f2,f3]</span><br><span class="line">B=Ideal(F).groebner_basis()</span><br><span class="line"><span class="comment">#B=[m + 21158731716376226090392498841915660119151249151578293634082749989659307225047065454562556490794720241251831294269248252992828782428316834166828404876181491874871787144664849984606114249820338190252050491223066273953777506705536480844475141933848618113343415375867066617512805575869013694523034573111259114274, 87038069032840052005520908272237788908169043580221040711149494083975743478969]</span></span><br><span class="line">q=B[<span class="number">1</span>]</span><br><span class="line">r=n//<span class="built_in">int</span>(q)//<span class="built_in">int</span>(p)</span><br></pre></td></tr></table></figure>
<p>然后在模q下f2，f3=0，gcd可以出q</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">m=B[<span class="number">0</span>].constant_coefficient()<span class="comment">#wp看到的，这函数干嘛的,应该是求解这个全局基用的，但是按我的理解这里的m不应该是-211...吗为什么这里出来是正的，看wp那边也是手动加了负号，emmm迟点再查查</span></span><br><span class="line">m=(-m)%q</span><br><span class="line"><span class="comment">#m直接出来东西不对。因为是在模q下，真m值可能大于q,看都是爆破的，前面在模q下解copper试了一下也没出来东西,那我也来爆一个</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000000</span>):</span><br><span class="line">    flag=long_to_bytes(<span class="built_in">int</span>(m)+i*<span class="built_in">int</span>(q))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b"dasctf{"</span> <span class="keyword">in</span> flag :</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>dasctf{ShangPoXiaPoYaSiLeYiQianDuo}</p>
<p>出来了。另外有个求出q后不继续求解groebner_basis，用其他方式求m的。</p>
<p>想明白了，直接贴一个吧。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">P.&lt;x&gt; = PolynomialRing(Zmod(q))</span><br><span class="line">f1=<span class="number">1997</span>-c2</span><br><span class="line">f2=<span class="number">1997</span>-c3</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line">    f1+=(x*t)^i</span><br><span class="line">    f2+=(x+t)^i</span><br><span class="line"><span class="built_in">print</span>(-gcd(f1,f2)[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>
<p>简单来说就是gcd的结果确实是q，但是是x+int的形式，所以有x+int=q这就解出来了x也就是上面那个m</p>
<p>小结：1.老方法，利用模数的“变化”（指p变n n变q这种）来调整式子，以方便某些求解。2.学到了个新东西Gr¨obner Bases，不过学的很粗浅大概意思就是对于一个多元多项式方程组，可以通过求Gr¨obner bases的方式来求解变量，不太明白更具体的使用范围和条件。</p>
<h2 id="7月赛ezRSA"><a href="#7月赛ezRSA" class="headerlink" title="7月赛ezRSA"></a><h2 id="2">7月赛ezRSA</h2></h2><p><a target="_blank" rel="noopener" href="http://blog.xmcve.com/2023/07/23/DASCTF-2023-0X401七月暑期挑战赛-Writeup/#title-17">DASCTF 2023 &amp; 0X401七月暑期挑战赛 Writeup - 星盟安全团队 (xmcve.com)</a>深度搜索 来再玩一下</p>
<p>源码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> secret, flag</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"><span class="keyword">assert</span> flag == <span class="string">b"dasctf{"</span> + secret + <span class="string">b"}"</span></span><br><span class="line">e = <span class="number">11</span></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p * q</span><br><span class="line">P = getPrime(<span class="number">512</span>)</span><br><span class="line">Q = getPrime(<span class="number">512</span>)</span><br><span class="line">N = P * Q</span><br><span class="line">gift = P ^ (Q &gt;&gt; <span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(N, gift, <span class="built_in">pow</span>(n, e, N))</span><br><span class="line"><span class="built_in">print</span>(encrypt(bytes_to_long(secret)),</span><br><span class="line">    encrypt(bytes_to_long(flag)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 75000029602085996700582008490482326525611947919932949726582734167668021800854674616074297109962078048435714672088452939300776268788888016125632084529419230038436738761550906906671010312930801751000022200360857089338231002088730471277277319253053479367509575754258003761447489654232217266317081318035524086377 8006730615575401350470175601463518481685396114003290299131469001242636369747855817476589805833427855228149768949773065563676033514362512835553274555294034 14183763184495367653522884147951054630177015952745593358354098952173965560488104213517563098676028516541915855754066719475487503348914181674929072472238449853082118064823835322313680705889432313419976738694317594843046001448855575986413338142129464525633835911168202553914150009081557835620953018542067857943</span></span><br><span class="line"><span class="comment"># 69307306970629523181683439240748426263979206546157895088924929426911355406769672385984829784804673821643976780928024209092360092670457978154309402591145689825571209515868435608753923870043647892816574684663993415796465074027369407799009929334083395577490711236614662941070610575313972839165233651342137645009 46997465834324781573963709865566777091686340553483507705539161842460528999282057880362259416654012854237739527277448599755805614622531827257136959664035098209206110290879482726083191005164961200125296999449598766201435057091624225218351537278712880859703730566080874333989361396420522357001928540408351500991</span></span><br></pre></td></tr></table></figure>
<p>求解q,p部分。</p>
<p>用的是星盟wp里深搜的方法。</p>
<p>几个复现时候注意到的小点：</p>
<ol>
<li>从高位搜会比低位搜代码难看一点，但应该也是可行的</li>
<li>整个代码比较整齐，主要通过两个限制条件快速筛去大部分不可能情况（仅保证gift这一个条件会因为范围小出不来，当时做题的时候有人说只保证了pq乘积的高位与n高位相等，应该也是条件给少了一个）</li>
<li>因为gift是p异或q右移16位的结果，所以p的最后一位1相当于异或了q的第十七位。这也就是为什么只搜p而不是同时搜p，q，传入的也不是q的末位1而是q的末17位，在调用函数的时候才会有爆破了q后17位的操作。</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">N=<span class="number">75000029602085996700582008490482326525611947919932949726582734167668021800854674616074297109962078048435714672088452939300776268788888016125632084529419230038436738761550906906671010312930801751000022200360857089338231002088730471277277319253053479367509575754258003761447489654232217266317081318035524086377</span></span><br><span class="line">gift=<span class="number">8006730615575401350470175601463518481685396114003290299131469001242636369747855817476589805833427855228149768949773065563676033514362512835553274555294034</span></span><br><span class="line">c1=<span class="number">14183763184495367653522884147951054630177015952745593358354098952173965560488104213517563098676028516541915855754066719475487503348914181674929072472238449853082118064823835322313680705889432313419976738694317594843046001448855575986413338142129464525633835911168202553914150009081557835620953018542067857943</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">findp</span>(<span class="params">p,q</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(p)==<span class="number">512</span>:</span><br><span class="line">        p1=<span class="built_in">int</span>(p,<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">if</span> N % p1 ==<span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(p1,N//p1)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        bit=<span class="built_in">len</span>(p)</span><br><span class="line">        p1=<span class="built_in">int</span>(p,<span class="number">2</span>)</span><br><span class="line">        q1=<span class="built_in">int</span>(q,<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">if</span> (p1^(q1&gt;&gt;<span class="number">16</span>))%(<span class="number">2</span>**bit)==gift%(<span class="number">2</span>**bit) <span class="keyword">and</span> p1*q1%(<span class="number">2</span>**bit)==N%(<span class="number">2</span>**bit):<span class="comment">#当目前深搜出来的位数符合实际，继续搜索。</span></span><br><span class="line">            findp(<span class="string">'1'</span>+p,<span class="string">'1'</span>+q)</span><br><span class="line">            findp(<span class="string">'0'</span>+p,<span class="string">'1'</span>+q)</span><br><span class="line">            findp(<span class="string">'0'</span>+p,<span class="string">'0'</span>+q)</span><br><span class="line">            findp(<span class="string">'1'</span>+p,<span class="string">'0'</span>+q)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**<span class="number">17</span>):</span><br><span class="line">    findp(<span class="string">'1'</span>,<span class="built_in">bin</span>(i)[<span class="number">2</span>:])<span class="comment">#else会返回none 所以没办法赋值。</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>下一步，有叫关联信息攻击的，也有叫明文线性攻击的</p>
<p>找了一下，叫Franklin-Reiter相关消息攻击</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/XiongSiqi_blog/article/details/130978226?spm=1001.2014.3001.5502">Franklin-Reiter相关消息攻击_Emmaaaaaaaaaa的博客-CSDN博客</a><del>别吐槽为什么又是csdn了，我的bing就是出来了这些，我又懒得多走一步geogle</del></p>
<p><del>简单概括一下</del></p>
<p>说的挺清晰的，不概括了：</p>
<p><img src="/2023/09/06/2023DSACTF-Crypto%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/pic.png" alt="pic"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">GCD</span>(<span class="params">a,b</span>):</span><br><span class="line">    <span class="keyword">if</span> b==<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> a.monic()<span class="comment">#a.monic()是一个多项式a的方法，用于将多项式转化为首项系数为1的首一多项式（monic polynomial）</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> GCD(b,a%b)</span><br><span class="line">PR.&lt;x&gt;=PolynomialRing(Zmod(n))</span><br><span class="line">f1=x^e-c2</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">    f2=(bytes_to_long(<span class="string">b"dasctf{"</span>+<span class="string">b'\x00'</span>*i+<span class="string">b"}"</span>)+<span class="number">256</span>*x)^e-c3</span><br><span class="line">    res=GCD(f1,f2)</span><br><span class="line">    <span class="keyword">if</span> res[<span class="number">0</span>]!=<span class="number">1</span>:</span><br><span class="line">        <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(-res[<span class="number">0</span>]%n)))</span><br></pre></td></tr></table></figure>
<p>另外，根据上一题的复现经验，也来试试groebner_basis的求解</p>
<p>其实之前试过但没有出来，原因在于爆破flag长度的时候使用了<em>256\</em>i<em>，这里应该使用</em>b’\x00’*i*转long</p>
<p>另外当时的n没有进行+N处理，如果仔细检查可以发现n可分解而且最后一个数是2，加了N后就不可分解了，这手真是坑啊，如果临场做到爆破结束没出结果肯定会很懵逼吧草。<br><del>到时候是不是也可以坑一手新人</del>（坏笑</p>
<p><del>顺带吐槽这个sage在我没有给n套int的时候n+N没有成功，害我浪费了不少时间，原理是用pow函数的时候出来的n是在环N上的，所以加了等于没加，超</del></p>
<p>总之以下是exp，flag需要肉眼识别一下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span>*</span><br><span class="line">N=<span class="number">75000029602085996700582008490482326525611947919932949726582734167668021800854674616074297109962078048435714672088452939300776268788888016125632084529419230038436738761550906906671010312930801751000022200360857089338231002088730471277277319253053479367509575754258003761447489654232217266317081318035524086377</span></span><br><span class="line">c1=<span class="number">14183763184495367653522884147951054630177015952745593358354098952173965560488104213517563098676028516541915855754066719475487503348914181674929072472238449853082118064823835322313680705889432313419976738694317594843046001448855575986413338142129464525633835911168202553914150009081557835620953018542067857943</span></span><br><span class="line">c2=<span class="number">69307306970629523181683439240748426263979206546157895088924929426911355406769672385984829784804673821643976780928024209092360092670457978154309402591145689825571209515868435608753923870043647892816574684663993415796465074027369407799009929334083395577490711236614662941070610575313972839165233651342137645009</span></span><br><span class="line">c3=<span class="number">46997465834324781573963709865566777091686340553483507705539161842460528999282057880362259416654012854237739527277448599755805614622531827257136959664035098209206110290879482726083191005164961200125296999449598766201435057091624225218351537278712880859703730566080874333989361396420522357001928540408351500991</span></span><br><span class="line">e=<span class="number">11</span></span><br><span class="line">P=<span class="number">8006847171912577069085166877758626954304824756138758266557706391662987806065132448544117840031499707938227955094109779732609035310252723066470330862622641</span></span><br><span class="line">Q=<span class="number">9366986529377069783394625848920106951220134111548343265311677163992169555436421569730703291128771472885865288798344038000984911921843088200997725324682297</span></span><br><span class="line">phi=(Q-<span class="number">1</span>)*(P-<span class="number">1</span>)</span><br><span class="line">d=gmpy2.invert(e,phi)</span><br><span class="line">n=<span class="built_in">pow</span>(c1,d,N)</span><br><span class="line">n=<span class="built_in">int</span>(n)+N</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getflag</span>(<span class="params">a,e,n,c2,c3</span>):</span><br><span class="line">    P.&lt; m,m0 &gt;= PolynomialRing(Zmod(n))</span><br><span class="line">    f1 = m ^ e - c2</span><br><span class="line">    f2 = (a+<span class="number">256</span>*m) ^ e - c3</span><br><span class="line">    F=[f1,f2]</span><br><span class="line">    B=Ideal(F).groebner_basis()</span><br><span class="line">    res=[i.constant_coefficient() <span class="keyword">for</span> i <span class="keyword">in</span> B]</span><br><span class="line">    <span class="comment">#print(B)</span></span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(-res[<span class="number">0</span>]%n)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">    getflag(bytes_to_long(<span class="string">b"dasctf{"</span>+<span class="string">b'\x00'</span>*i+<span class="string">b"}"</span>),e,n,c2,c3)</span><br></pre></td></tr></table></figure>
<p>最后，关于第一部分，再来复现一下当时有人提到的另一个思路的做法（也在wp中有看到）</p>

        
      </div>

         
    </div>
    
     
  </div>
  
    
<nav id="article-nav">
  <a class="article-nav-btn left "
    
      href="/2023/09/06/ROCA%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94CVE-2017-15361/"
      title="ROCA攻击——CVE-2017-15361"
     >
    <i class="fa-solid fa-angle-left"></i>
    <p class="title-text">
      
        ROCA攻击——CVE-2017-15361
        
    </p>
  </a>
  <a class="article-nav-btn right  disabled "
     >

    <p class="title-text">
        
    </p>
    <i class="fa-solid fa-angle-right"></i>
  </a>
</nav>


  
</article>

 
    </div>
    <div id="footer-wrapper">
      <footer id="footer">
  
  <div id="footer-info" class="inner">
    
    &copy; 2023 crumbling<br>
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & Theme <a target="_blank" rel="noopener" href="https://github.com/saicaca/hexo-theme-vivia">Vivia</a>
  </div>
</footer>

    </div>
    <div class="back-to-top-wrapper">
    <button id="back-to-top-btn" class="back-to-top-btn hide" onclick="topFunction()">
        <span class="material-symbols-rounded">keyboard_arrow_up</span>
    </button>
</div>

<script>
    function topFunction() {
        window.scroll({ top: 0, behavior: 'smooth' });
    }
    let btn = document.getElementById('back-to-top-btn');
    function scrollFunction() {
        if (document.body.scrollTop > 600 || document.documentElement.scrollTop > 600) {
            btn.classList.remove('hide')
        } else {
            btn.classList.add('hide')
        }
    }
    window.onscroll = function() {
        scrollFunction();
    }
</script>

  </div>
  <script src="/js/light-dark-switch.js"></script>
</body>
</html>
